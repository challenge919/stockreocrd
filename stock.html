
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘çš„æŠ•è³‡è¿½è¹¤å™¨ | ç¾è‚¡/æ¸¯è‚¡/æ¯”ç‰¹å¹£</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
}

body {
background: #f0f2f5;
color: #333;
padding: 20px;
}

.container {
max-width: 1200px;
margin: 0 auto;
}

header {
background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
color: white;
padding: 25px;
border-radius: 15px;
margin-bottom: 25px;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

h1 {
font-size: 28px;
margin-bottom: 10px;
}

.stats {
display: flex;
gap: 20px;
margin-top: 20px;
flex-wrap: wrap;
}

.stat-box {
background: rgba(255, 255, 255, 0.2);
padding: 15px;
border-radius: 10px;
min-width: 180px;
}

.stat-value {
font-size: 24px;
font-weight: bold;
margin-bottom: 5px;
}

.main-content {
display: grid;
grid-template-columns: 300px 1fr;
gap: 20px;
}

.sidebar {
background: white;
padding: 20px;
border-radius: 15px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.content {
display: flex;
flex-direction: column;
gap: 20px;
}

.card {
background: white;
padding: 20px;
border-radius: 15px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.card-title {
font-size: 18px;
font-weight: bold;
color: #1e40af;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 2px solid #f0f2f5;
}

.tabs {
display: flex;
gap: 5px;
background: #f0f2f5;
padding: 5px;
border-radius: 10px;
margin-bottom: 20px;
}

.tab {
flex: 1;
padding: 10px;
text-align: center;
background: none;
border: none;
border-radius: 8px;
cursor: pointer;
font-weight: 500;
}

.tab.active {
background: white;
color: #1e40af;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.form-group {
margin-bottom: 15px;
}

label {
display: block;
margin-bottom: 5px;
font-weight: 500;
color: #555;
}

input, select {
width: 100%;
padding: 10px;
border: 1px solid #ddd;
border-radius: 8px;
font-size: 14px;
}

.btn {
background: #3b82f6;
color: white;
border: none;
padding: 12px 20px;
border-radius: 8px;
cursor: pointer;
font-weight: 600;
width: 100%;
margin-top: 10px;
}

.btn:hover {
background: #2563eb;
}

.btn-success {
background: #10b981;
}

.btn-danger {
background: #ef4444;
}

.btn-edit {
background: #f59e0b;
color: white;
border: none;
padding: 5px 10px;
border-radius: 5px;
cursor: pointer;
margin-right: 5px;
}

.goal-item {
background: #f8fafc;
padding: 15px;
border-radius: 10px;
margin-bottom: 15px;
border-left: 4px solid #3b82f6;
position: relative;
}

.goal-actions {
position: absolute;
top: 10px;
right: 10px;
display: flex;
gap: 5px;
}

.goal-header {
display: flex;
justify-content: space-between;
margin-bottom: 10px;
}

.progress-bar {
height: 8px;
background: #e5e7eb;
border-radius: 4px;
overflow: hidden;
margin: 10px 0;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, #3b82f6, #8b5cf6);
border-radius: 4px;
transition: width 0.5s ease;
}

table {
width: 100%;
border-collapse: collapse;
margin-top: 10px;
}

th {
background: #f8fafc;
padding: 12px;
text-align: left;
font-weight: 600;
color: #4b5563;
}

td {
padding: 12px;
border-bottom: 1px solid #e5e7eb;
}

.profit {
color: #10b981;
font-weight: 600;
}

.loss {
color: #ef4444;
font-weight: 600;
}

.search-box {
margin-bottom: 20px;
}

.search-input {
width: 100%;
padding: 12px;
border: 1px solid #ddd;
border-radius: 8px;
font-size: 14px;
}

.chart-container {
height: 300px;
margin-top: 20px;
}

.quote-box {
background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
padding: 25px;
border-radius: 15px;
text-align: center;
margin: 20px 0;
}

.quote-text {
font-size: 18px;
font-style: italic;
margin-bottom: 15px;
color: #1e40af;
}

.share-buttons {
display: flex;
gap: 10px;
justify-content: center;
margin-top: 20px;
}

.share-btn {
padding: 10px 20px;
border-radius: 8px;
border: none;
cursor: pointer;
font-weight: 500;
display: flex;
align-items: center;
gap: 8px;
}

.setting-item {
margin-bottom: 15px;
}

.setting-title {
font-weight: 600;
margin-bottom: 5px;
color: #4b5563;
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 1000;
justify-content: center;
align-items: center;
}

.modal-content {
background: white;
padding: 30px;
border-radius: 15px;
max-width: 500px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
}

.modal-title {
font-size: 20px;
font-weight: bold;
margin-bottom: 20px;
color: #1e40af;
}

.modal-actions {
display: flex;
gap: 10px;
margin-top: 20px;
}

.cashflow-item {
background: #f8fafc;
padding: 10px;
border-radius: 8px;
margin-bottom: 8px;
display: flex;
justify-content: space-between;
align-items: center;
}

@media (max-width: 768px) {
.main-content {
grid-template-columns: 1fr;
}

.stats {
flex-direction: column;
}
}
</style>
</head>
<body>
<div class="container">
<header>
<h1>ğŸ“ˆ æˆ‘çš„æŠ•è³‡è¿½è¹¤å™¨</h1>
<p>è¨˜éŒ„ç¾è‚¡ã€æ¸¯è‚¡ã€æ¯”ç‰¹å¹£æŠ•è³‡ï¼Œè¿½è¹¤è²¡å‹™ç›®æ¨™</p>

<div class="stats">
<div class="stat-box">
<div class="stat-value" id="totalValue">$0</div>
<div>ç¸½è³‡ç”¢</div>
</div>
<div class="stat-box">
<div class="stat-value" id="totalProfit">$0</div>
<div>ç¸½ç›ˆè™§</div>
</div>
<div class="stat-box">
<div class="stat-value" id="goalProgress">0%</div>
<div>ç›®æ¨™é€²åº¦</div>
</div>
<div class="stat-box">
<div class="stat-value" id="roi">0%</div>
<div>å›å ±ç‡</div>
</div>
</div>
</header>

<div class="main-content">
<div class="sidebar">
<div class="card">
<div class="card-title">ğŸ¯ è¨­å®šç›®æ¨™</div>
<div class="form-group">
<label>ç›®æ¨™åç¨±</label>
<input type="text" id="goalName" placeholder="è²¡å‹™è‡ªç”±">
</div>
<div class="form-group">
<label>ç›®æ¨™é‡‘é¡ (USD)</label>
<input type="number" id="goalAmount" placeholder="1000000">
</div>
<div class="form-group">
<label>æœŸé™ (å¹´)</label>
<input type="number" id="goalYears" placeholder="10">
</div>
<button class="btn" onclick="addGoal()">æ–°å¢ç›®æ¨™</button>

<div id="goalsList" style="margin-top: 20px;"></div>
</div>

<div class="card" style="margin-top: 20px;">
<div class="card-title">ğŸ’° ç¾é‡‘æµè¨˜éŒ„</div>
<div class="form-group">
<label>é¡å‹</label>
<select id="cashflowType">
<option value="deposit">å­˜å…¥è³‡é‡‘</option>
<option value="withdraw">æå–è³‡é‡‘</option>
</select>
</div>
<div class="form-group">
<label>é‡‘é¡ (USD)</label>
<input type="number" id="cashflowAmount" placeholder="1000">
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" id="cashflowDate">
</div>
<button class="btn" onclick="addCashflow()">è¨˜éŒ„ç¾é‡‘æµ</button>

<div style="margin-top: 20px;">
<h4 style="margin-bottom: 10px;">ç¾é‡‘æµç´€éŒ„</h4>
<div id="cashflowList" style="max-height: 200px; overflow-y: auto;">
<!-- ç¾é‡‘æµè¨˜éŒ„å°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
</div>
<div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
<span style="font-weight: bold;">ç¸½å­˜å…¥:</span>
<span id="totalDeposit" style="font-weight: bold;">$0</span>
</div>
<div style="display: flex; justify-content: space-between; margin-top: 5px;">
<span style="font-weight: bold;">ç¸½æå–:</span>
<span id="totalWithdraw" style="font-weight: bold;">$0</span>
</div>
<div style="display: flex; justify-content: space-between; margin-top: 5px; padding-top: 5px; border-top: 1px solid #e5e7eb;">
<span style="font-weight: bold;">æ·¨ç¾é‡‘æµ:</span>
<span id="netCashflow" style="font-weight: bold;">$0</span>
</div>
</div>
</div>
</div>

<div class="content">
<div class="card">
<div class="card-title">ğŸ“Š æŠ•è³‡è¨˜éŒ„</div>

<div class="tabs">
<button class="tab active" onclick="switchTab('us')">ç¾è‚¡</button>
<button class="tab" onclick="switchTab('hk')">æ¸¯è‚¡</button>
<button class="tab" onclick="switchTab('btc')">æ¯”ç‰¹å¹£</button>
<button class="tab" onclick="switchTab('all')">å…¨éƒ¨</button>
</div>

<div class="search-box">
<input type="text" class="search-input" id="searchInput" placeholder="æœå°‹è‚¡ç¥¨ä»£è™Ÿæˆ–åç¨±...">
</div>

<!-- ç¾è‚¡è¡¨å–® -->
<div id="usForm" class="tab-content">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
<div class="form-group">
<label>è‚¡ç¥¨ä»£è™Ÿ</label>
<input type="text" id="usSymbol" placeholder="AAPL">
</div>
<div class="form-group">
<label>æ“ä½œ</label>
<select id="usAction" onchange="toggleSellPrice(this)">
<option value="buy">è²·å…¥</option>
<option value="sell">è³£å‡º</option>
</select>
</div>
<div class="form-group">
<label>è‚¡æ•¸</label>
<input type="number" id="usShares" placeholder="10">
</div>
<div class="form-group">
<label>è²·å…¥åƒ¹æ ¼ (USD)</label>
<input type="number" id="usBuyPrice" placeholder="150.50">
</div>
<div class="form-group" id="usSellPriceGroup" style="display: none;">
<label>è³£å‡ºåƒ¹æ ¼ (USD)</label>
<input type="number" id="usSellPrice" placeholder="180.00">
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" id="usDate">
</div>
</div>
<button class="btn" onclick="addRecord('us')">æ·»åŠ è¨˜éŒ„</button>
</div>

<!-- æ¸¯è‚¡è¡¨å–® -->
<div id="hkForm" class="tab-content" style="display: none;">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
<div class="form-group">
<label>è‚¡ç¥¨ä»£è™Ÿ</label>
<input type="text" id="hkSymbol" placeholder="0700">
</div>
<div class="form-group">
<label>æ“ä½œ</label>
<select id="hkAction" onchange="toggleSellPriceHK(this)">
<option value="buy">è²·å…¥</option>
<option value="sell">è³£å‡º</option>
</select>
</div>
<div class="form-group">
<label>è‚¡æ•¸</label>
<input type="number" id="hkShares" placeholder="100">
</div>
<div class="form-group">
<label>è²·å…¥åƒ¹æ ¼ (HKD)</label>
<input type="number" id="hkBuyPrice" placeholder="350.20">
</div>
<div class="form-group" id="hkSellPriceGroup" style="display: none;">
<label>è³£å‡ºåƒ¹æ ¼ (HKD)</label>
<input type="number" id="hkSellPrice" placeholder="400.00">
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" id="hkDate">
</div>
</div>
<button class="btn" onclick="addRecord('hk')">æ·»åŠ è¨˜éŒ„</button>
</div>

<!-- æ¯”ç‰¹å¹£è¡¨å–® -->
<div id="btcForm" class="tab-content" style="display: none;">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
<div class="form-group">
<label>æ“ä½œ</label>
<select id="btcAction" onchange="toggleSellPriceBTC(this)">
<option value="buy">è²·å…¥</option>
<option value="sell">è³£å‡º</option>
</select>
</div>
<div class="form-group">
<label>æ•¸é‡ (BTC)</label>
<input type="number" id="btcAmount" placeholder="0.05">
</div>
<div class="form-group">
<label>è²·å…¥åƒ¹æ ¼ (USD)</label>
<input type="number" id="btcBuyPrice" placeholder="45000">
</div>
<div class="form-group" id="btcSellPriceGroup" style="display: none;">
<label>è³£å‡ºåƒ¹æ ¼ (USD)</label>
<input type="number" id="btcSellPrice" placeholder="50000">
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" id="btcDate">
</div>
</div>
<button class="btn" onclick="addRecord('btc')">æ·»åŠ è¨˜éŒ„</button>
</div>

<!-- è¨˜éŒ„è¡¨æ ¼ -->
<div style="margin-top: 20px; overflow-x: auto;">
<table id="recordsTable">
<thead>
<tr>
<th>å¸‚å ´</th>
<th>ä»£è™Ÿ</th>
<th>æ“ä½œ</th>
<th>æ•¸é‡</th>
<th>è²·å…¥åƒ¹</th>
<th>è³£å‡ºåƒ¹</th>
<th>ç¸½é¡</th>
<th>æ—¥æœŸ</th>
<th>ç›ˆè™§</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody id="recordsBody"></tbody>
</table>
</div>
</div>

<div class="card">
<div class="card-title">ğŸ“ˆ æŠ•è³‡çµ„åˆåˆ†æ</div>
<div class="chart-container">
<canvas id="portfolioChart"></canvas>
</div>
<div style="margin-top: 15px; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;">
<div style="text-align: center;">
<div style="font-size: 24px; font-weight: bold; color: #3b82f6;" id="usPercent">0%</div>
<div style="font-size: 12px; color: #666;">ç¾è‚¡æ¯”ä¾‹</div>
</div>
<div style="text-align: center;">
<div style="font-size: 24px; font-weight: bold; color: #10b981;" id="hkPercent">0%</div>
<div style="font-size: 12px; color: #666;">æ¸¯è‚¡æ¯”ä¾‹</div>
</div>
<div style="text-align: center;">
<div style="font-size: 24px; font-weight: bold; color: #f59e0b;" id="btcPercent">0%</div>
<div style="font-size: 12px; color: #666;">æ¯”ç‰¹å¹£æ¯”ä¾‹</div>
</div>
<div style="text-align: center;">
<div style="font-size: 24px; font-weight: bold; color: #94a3b8;" id="cashPercent">0%</div>
<div style="font-size: 12px; color: #666;">ç¾é‡‘æ¯”ä¾‹</div>
</div>
</div>
</div>

<div class="card">
<div class="card-title">ğŸ’° è²¡å‹™è‡ªç”±é€²åº¦è¡¨</div>
<div style="margin-bottom: 15px;">
<p>æ ¹æ“šç•¶å‰æŠ•è³‡çµ„åˆåƒ¹å€¼å’Œç›®æ¨™ï¼Œé æ¸¬é”æˆè²¡å‹™è‡ªç”±çš„æ™‚é–“ï¼š</p>
<div id="freedomPrediction" style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-top: 10px;">
<!-- é æ¸¬çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
</div>
</div>
</div>

<div class="quote-box">
<div class="quote-text" id="quoteText">
"æŠ•è³‡å°±åƒæ»¾é›ªçƒï¼Œä½ éœ€è¦æ‰¾åˆ°æ¿•æ½¤çš„é›ªå’Œé•·é•·çš„å¡é“ã€‚"
</div>
<div class="share-buttons">
<button class="share-btn" style="background: #000; color: white;" onclick="shareToThreads()">
ğŸ“± Threadsåˆ†äº«
</button>
<button class="share-btn" style="background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584); color: white;" onclick="shareToIG()">
ğŸ“¸ IGåˆ†äº«
</button>
<button class="share-btn" style="background: #3b82f6; color: white;" onclick="generateNewQuote()">
ğŸ”„ æ–°é‡‘å¥
</button>
</div>
</div>

<div class="card">
<div class="card-title">âš™ï¸ è¨­å®š</div>
<div class="setting-item">
<div class="setting-title">è²¨å¹£è¨­å®š</div>
<select id="currencySetting" onchange="updateCurrency()">
<option value="USD">ç¾å…ƒ (USD)</option>
<option value="HKD">æ¸¯å¹£ (HKD)</option>
<option value="TWD">å°å¹£ (TWD)</option>
</select>
</div>
<div class="setting-item">
<div class="setting-title">åŒ¯ç‡è¨­å®š</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
<div>
<label>USD/HKD</label>
<input type="number" id="usdHkdRate" value="7.8">
</div>
<div>
<label>USD/TWD</label>
<input type="number" id="usdTwdRate" value="31.5">
</div>
</div>
</div>
<div class="setting-item">
<button class="btn" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
<button class="btn btn-danger" onclick="clearAllData()" style="margin-top: 10px;">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
</div>
</div>
</div>
</div>
</div>

<!-- ç·¨è¼¯ç›®æ¨™æ¨¡æ…‹æ¡† -->
<div class="modal" id="editGoalModal">
<div class="modal-content">
<div class="modal-title">ç·¨è¼¯ç›®æ¨™</div>
<div class="form-group">
<label>ç›®æ¨™åç¨±</label>
<input type="text" id="editGoalName">
</div>
<div class="form-group">
<label>ç›®æ¨™é‡‘é¡ (USD)</label>
<input type="number" id="editGoalAmount">
</div>
<div class="form-group">
<label>æœŸé™ (å¹´)</label>
<input type="number" id="editGoalYears">
</div>
<div class="modal-actions">
<button class="btn btn-success" onclick="saveEditedGoal()">å„²å­˜</button>
<button class="btn btn-danger" onclick="closeEditModal()">å–æ¶ˆ</button>
</div>
</div>
</div>

<script>
// åˆå§‹åŒ–æ•¸æ“š
let records = JSON.parse(localStorage.getItem('investmentRecords')) || [];
let goals = JSON.parse(localStorage.getItem('investmentGoals')) || [];
let cashflows = JSON.parse(localStorage.getItem('cashflows')) || [];
let settings = JSON.parse(localStorage.getItem('settings')) || {
currency: 'USD',
usdHkdRate: 7.8,
usdTwdRate: 31.5
};

let portfolioChart = null;
let currentEditingGoalId = null;
let currentTab = 'us';

// åˆå§‹åŒ–é é¢
document.addEventListener('DOMContentLoaded', function() {
// è¨­å®šæ—¥æœŸç‚ºä»Šå¤©
const today = new Date().toISOString().split('T')[0];
document.getElementById('usDate').value = today;
document.getElementById('hkDate').value = today;
document.getElementById('btcDate').value = today;
document.getElementById('cashflowDate').value = today;

// è¼‰å…¥è¨­å®š
loadSettings();

// è¼‰å…¥æ•¸æ“š
loadGoals();
loadCashflows();
loadRecords();

// æ›´æ–°é¡¯ç¤º
updateStats();
generateNewQuote();
updateFreedomPrediction();

// åˆå§‹åŒ–åœ–è¡¨
initializeChart();

// è¨­å®šæœå°‹åŠŸèƒ½
document.getElementById('searchInput').addEventListener('input', searchRecords);
});

// åˆ‡æ›è³£å‡ºåƒ¹æ ¼é¡¯ç¤º
function toggleSellPrice(select) {
const sellPriceGroup = document.getElementById('usSellPriceGroup');
if (select.value === 'sell') {
sellPriceGroup.style.display = 'block';
} else {
sellPriceGroup.style.display = 'none';
}
}

function toggleSellPriceHK(select) {
const sellPriceGroup = document.getElementById('hkSellPriceGroup');
if (select.value === 'sell') {
sellPriceGroup.style.display = 'block';
} else {
sellPriceGroup.style.display = 'none';
}
}

function toggleSellPriceBTC(select) {
const sellPriceGroup = document.getElementById('btcSellPriceGroup');
if (select.value === 'sell') {
sellPriceGroup.style.display = 'block';
} else {
sellPriceGroup.style.display = 'none';
}
}

// è¼‰å…¥è¨­å®š
function loadSettings() {
document.getElementById('currencySetting').value = settings.currency;
document.getElementById('usdHkdRate').value = settings.usdHkdRate;
document.getElementById('usdTwdRate').value = settings.usdTwdRate;
}

// å„²å­˜è¨­å®š
function saveSettings() {
settings.currency = document.getElementById('currencySetting').value;
settings.usdHkdRate = parseFloat(document.getElementById('usdHkdRate').value);
settings.usdTwdRate = parseFloat(document.getElementById('usdTwdRate').value);

localStorage.setItem('settings', JSON.stringify(settings));
alert('è¨­å®šå·²å„²å­˜ï¼');
updateStats();
}

// åˆ‡æ›æ¨™ç±¤
function switchTab(tab) {
currentTab = tab;

// æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
document.querySelectorAll('.tab').forEach(btn => {
btn.classList.remove('active');
});
event.target.classList.add('active');

// é¡¯ç¤ºå°æ‡‰è¡¨å–®
document.getElementById('usForm').style.display = 'none';
document.getElementById('hkForm').style.display = 'none';
document.getElementById('btcForm').style.display = 'none';

if (tab === 'us') {
document.getElementById('usForm').style.display = 'block';
} else if (tab === 'hk') {
document.getElementById('hkForm').style.display = 'block';
} else if (tab === 'btc') {
document.getElementById('btcForm').style.display = 'block';
}

// é¡¯ç¤ºè¨˜éŒ„
if (tab === 'all') {
displayAllRecords();
} else {
displayRecords(tab);
}
}

// æ·»åŠ æŠ•è³‡è¨˜éŒ„
function addRecord(type) {
let record = {};

if (type === 'us') {
const symbol = document.getElementById('usSymbol').value.toUpperCase();
const action = document.getElementById('usAction').value;
const shares = parseFloat(document.getElementById('usShares').value);
const buyPrice = parseFloat(document.getElementById('usBuyPrice').value);
const sellPrice = action === 'sell' ? parseFloat(document.getElementById('usSellPrice').value) : null;
const date = document.getElementById('usDate').value;

if (!symbol || !shares || !buyPrice || !date || (action === 'sell' && !sellPrice)) {
alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
return;
}

const price = action === 'buy' ? buyPrice : sellPrice;
const total = shares * price;

record = {
id: Date.now(),
type: 'us',
symbol,
name: symbol,
action,
amount: shares,
buyPrice: action === 'sell' ? null : buyPrice,
sellPrice: action === 'sell' ? sellPrice : null,
price,
total,
date,
currency: 'USD'
};

// å¦‚æœæ˜¯è³£å‡ºï¼Œè¨ˆç®—ç›ˆè™§
if (action === 'sell') {
// æ‰¾å°æ‡‰çš„è²·å…¥è¨˜éŒ„ä¾†è¨ˆç®—ç›ˆè™§
const matchingBuy = findMatchingBuyRecord(type, symbol, shares);
if (matchingBuy) {
const profitLoss = (sellPrice - matchingBuy.buyPrice) * shares;
record.profitLoss = profitLoss;
record.matchedBuyId = matchingBuy.id;
} else {
record.profitLoss = 0;
alert('æ‰¾ä¸åˆ°å°æ‡‰çš„è²·å…¥è¨˜éŒ„ï¼Œç„¡æ³•è¨ˆç®—ç›ˆè™§');
}
}

// æ¸…é™¤è¡¨å–®
document.getElementById('usSymbol').value = '';
document.getElementById('usShares').value = '';
document.getElementById('usBuyPrice').value = '';
document.getElementById('usSellPrice').value = '';
document.getElementById('usSellPriceGroup').style.display = 'none';
document.getElementById('usAction').value = 'buy';

} else if (type === 'hk') {
const symbol = document.getElementById('hkSymbol').value;
const action = document.getElementById('hkAction').value;
const shares = parseFloat(document.getElementById('hkShares').value);
const buyPrice = parseFloat(document.getElementById('hkBuyPrice').value);
const sellPrice = action === 'sell' ? parseFloat(document.getElementById('hkSellPrice').value) : null;
const date = document.getElementById('hkDate').value;

if (!symbol || !shares || !buyPrice || !date || (action === 'sell' && !sellPrice)) {
alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
return;
}

const price = action === 'buy' ? buyPrice : sellPrice;
const total = shares * price;

record = {
id: Date.now(),
type: 'hk',
symbol,
name: symbol,
action,
amount: shares,
buyPrice: action === 'sell' ? null : buyPrice,
sellPrice: action === 'sell' ? sellPrice : null,
price,
total,
date,
currency: 'HKD'
};

// å¦‚æœæ˜¯è³£å‡ºï¼Œè¨ˆç®—ç›ˆè™§
if (action === 'sell') {
const matchingBuy = findMatchingBuyRecord(type, symbol, shares);
if (matchingBuy) {
const profitLoss = (sellPrice - matchingBuy.buyPrice) * shares;
record.profitLoss = profitLoss;
record.matchedBuyId = matchingBuy.id;
} else {
record.profitLoss = 0;
alert('æ‰¾ä¸åˆ°å°æ‡‰çš„è²·å…¥è¨˜éŒ„ï¼Œç„¡æ³•è¨ˆç®—ç›ˆè™§');
}
}

// æ¸…é™¤è¡¨å–®
document.getElementById('hkSymbol').value = '';
document.getElementById('hkShares').value = '';
document.getElementById('hkBuyPrice').value = '';
document.getElementById('hkSellPrice').value = '';
document.getElementById('hkSellPriceGroup').style.display = 'none';
document.getElementById('hkAction').value = 'buy';

} else if (type === 'btc') {
const action = document.getElementById('btcAction').value;
const amount = parseFloat(document.getElementById('btcAmount').value);
const buyPrice = parseFloat(document.getElementById('btcBuyPrice').value);
const sellPrice = action === 'sell' ? parseFloat(document.getElementById('btcSellPrice').value) : null;
const date = document.getElementById('btcDate').value;

if (!amount || !buyPrice || !date || (action === 'sell' && !sellPrice)) {
alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
return;
}

const price = action === 'buy' ? buyPrice : sellPrice;
const total = amount * price;

record = {
id: Date.now(),
type: 'btc',
symbol: 'BTC',
name: 'æ¯”ç‰¹å¹£',
action,
amount,
buyPrice: action === 'sell' ? null : buyPrice,
sellPrice: action === 'sell' ? sellPrice : null,
price,
total,
date,
currency: 'USD'
};

// å¦‚æœæ˜¯è³£å‡ºï¼Œè¨ˆç®—ç›ˆè™§
if (action === 'sell') {
const matchingBuy = findMatchingBuyRecord(type, 'BTC', amount);
if (matchingBuy) {
const profitLoss = (sellPrice - matchingBuy.buyPrice) * amount;
record.profitLoss = profitLoss;
record.matchedBuyId = matchingBuy.id;
} else {
record.profitLoss = 0;
alert('æ‰¾ä¸åˆ°å°æ‡‰çš„è²·å…¥è¨˜éŒ„ï¼Œç„¡æ³•è¨ˆç®—ç›ˆè™§');
}
}

// æ¸…é™¤è¡¨å–®
document.getElementById('btcAmount').value = '';
document.getElementById('btcBuyPrice').value = '';
document.getElementById('btcSellPrice').value = '';
document.getElementById('btcSellPriceGroup').style.display = 'none';
document.getElementById('btcAction').value = 'buy';
}

// æ·»åŠ åˆ°è¨˜éŒ„
records.push(record);
saveRecords();

// æ›´æ–°é¡¯ç¤º
displayRecords(type);
updateStats();
updateChart();
updateFreedomPrediction();

alert('è¨˜éŒ„å·²æ·»åŠ ï¼');
}

// å°‹æ‰¾å°æ‡‰çš„è²·å…¥è¨˜éŒ„
function findMatchingBuyRecord(type, symbol, amount) {
// æ‰¾åŒä¸€é¡å‹ã€åŒä¸€è‚¡ç¥¨ä»£è™Ÿã€è²·å…¥æ“ä½œã€ä¸”æœªé…å°çš„è¨˜éŒ„
const buyRecords = records.filter(record =>
record.type === type &&
record.symbol === symbol &&
record.action === 'buy' &&
!record.matched
);

if (buyRecords.length > 0) {
// ç°¡å–®åŒ¹é…ï¼šæ‰¾ç¬¬ä¸€ç­†ç¬¦åˆçš„è²·å…¥è¨˜éŒ„
const matchedRecord = buyRecords[0];
matchedRecord.matched = true; // æ¨™è¨˜å·²é…å°
return matchedRecord;
}

return null;
}

// åˆªé™¤è¨˜éŒ„
function deleteRecord(id) {
if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) {
records = records.filter(record => record.id !== id);
saveRecords();
displayRecords(currentTab);
updateStats();
updateChart();
updateFreedomPrediction();
}
}

// é¡¯ç¤ºè¨˜éŒ„
function displayRecords(type) {
const filtered = records.filter(record => record.type === type);
displayRecordsInTable(filtered);
}

// é¡¯ç¤ºæ‰€æœ‰è¨˜éŒ„
function displayAllRecords() {
displayRecordsInTable(records);
}

// åœ¨è¡¨æ ¼ä¸­é¡¯ç¤ºè¨˜éŒ„
function displayRecordsInTable(recordsToShow) {
const tbody = document.getElementById('recordsBody');
tbody.innerHTML = '';

// æ’åºï¼šæœ€æ–°çš„åœ¨å‰é¢
recordsToShow.sort((a, b) => new Date(b.date) - new Date(a.date));

recordsToShow.forEach(record => {
const row = document.createElement('tr');

// æ ¹æ“šè¨­å®šè½‰æ›è²¨å¹£
let displayTotal = record.total;
let displayBuyPrice = record.buyPrice || '-';
let displaySellPrice = record.sellPrice || '-';
let displayProfitLoss = record.profitLoss || '-';

if (settings.currency !== 'USD') {
if (record.currency === 'HKD') {
if (settings.currency === 'HKD') {
displayTotal = record.total;
displayBuyPrice = record.buyPrice || '-';
displaySellPrice = record.sellPrice || '-';
displayProfitLoss = record.profitLoss || '-';
} else {
displayTotal = record.total / settings.usdHkdRate;
displayBuyPrice = record.buyPrice ? record.buyPrice / settings.usdHkdRate : '-';
displaySellPrice = record.sellPrice ? record.sellPrice / settings.usdHkdRate : '-';
displayProfitLoss = record.profitLoss ? record.profitLoss / settings.usdHkdRate : '-';
}
} else {
if (settings.currency === 'HKD') {
displayTotal = record.total * settings.usdHkdRate;
displayBuyPrice = record.buyPrice ? record.buyPrice * settings.usdHkdRate : '-';
displaySellPrice = record.sellPrice ? record.sellPrice * settings.usdHkdRate : '-';
displayProfitLoss = record.profitLoss ? record.profitLoss * settings.usdHkdRate : '-';
} else if (settings.currency === 'TWD') {
displayTotal = record.total * settings.usdTwdRate;
displayBuyPrice = record.buyPrice ? record.buyPrice * settings.usdTwdRate : '-';
displaySellPrice = record.sellPrice ? record.sellPrice * settings.usdTwdRate : '-';
displayProfitLoss = record.profitLoss ? record.profitLoss * settings.usdTwdRate : '-';
}
}
}

const currencySymbol = settings.currency === 'USD' ? '$' :
settings.currency === 'HKD' ? 'HK$' : 'NT$';

row.innerHTML = `
<td>${record.type === 'us' ? 'ç¾è‚¡' : record.type === 'hk' ? 'æ¸¯è‚¡' : 'æ¯”ç‰¹å¹£'}</td>
<td>${record.symbol}</td>
<td>${record.action === 'buy' ? 'è²·å…¥' : 'è³£å‡º'}</td>
<td>${record.amount}</td>
<td>${displayBuyPrice === '-' ? '-' : currencySymbol + displayBuyPrice.toFixed(2)}</td>
<td>${displaySellPrice === '-' ? '-' : currencySymbol + displaySellPrice.toFixed(2)}</td>
<td>${currencySymbol}${displayTotal.toFixed(2)}</td>
<td>${record.date}</td>
<td class="${displayProfitLoss === '-' ? '' : (displayProfitLoss >= 0 ? 'profit' : 'loss')}">
${displayProfitLoss === '-' ? '-' : (displayProfitLoss >= 0 ? '+' : '') + currencySymbol + displayProfitLoss.toFixed(2)}
</td>
<td>
<button style="padding: 5px 10px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;"
onclick="deleteRecord(${record.id})">
åˆªé™¤
</button>
</td>
`;
tbody.appendChild(row);
});
}

// æœå°‹è¨˜éŒ„
function searchRecords() {
const searchTerm = document.getElementById('searchInput').value.toLowerCase();

if (!searchTerm) {
displayAllRecords();
return;
}

const filtered = records.filter(record =>
record.symbol.toLowerCase().includes(searchTerm) ||
record.name.toLowerCase().includes(searchTerm) ||
record.type.includes(searchTerm)
);

displayRecordsInTable(filtered);
}

// æ·»åŠ ç›®æ¨™
function addGoal() {
const name = document.getElementById('goalName').value;
const amount = parseFloat(document.getElementById('goalAmount').value);
const years = parseInt(document.getElementById('goalYears').value);

if (!name || !amount || !years) {
alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
return;
}

const goal = {
id: Date.now(),
name,
amount,
years,
progress: 0,
created: new Date().toISOString()
};

goals.push(goal);
saveGoals();
loadGoals();
updateStats();
updateFreedomPrediction();

// æ¸…é™¤è¡¨å–®
document.getElementById('goalName').value = '';
document.getElementById('goalAmount').value = '';
document.getElementById('goalYears').value = '';

alert('ç›®æ¨™å·²æ·»åŠ ï¼');
}

// ç·¨è¼¯ç›®æ¨™
function editGoal(id) {
const goal = goals.find(g => g.id === id);
if (!goal) return;

currentEditingGoalId = id;
document.getElementById('editGoalName').value = goal.name;
document.getElementById('editGoalAmount').value = goal.amount;
document.getElementById('editGoalYears').value = goal.years;

document.getElementById('editGoalModal').style.display = 'flex';
}

// å„²å­˜ç·¨è¼¯çš„ç›®æ¨™
function saveEditedGoal() {
if (!currentEditingGoalId) return;

const goalIndex = goals.findIndex(g => g.id === currentEditingGoalId);
if (goalIndex === -1) return;

goals[goalIndex].name = document.getElementById('editGoalName').value;
goals[goalIndex].amount = parseFloat(document.getElementById('editGoalAmount').value);
goals[goalIndex].years = parseInt(document.getElementById('editGoalYears').value);

saveGoals();
loadGoals();
updateStats();
updateFreedomPrediction();
closeEditModal();

alert('ç›®æ¨™å·²æ›´æ–°ï¼');
}

// åˆªé™¤ç›®æ¨™
function deleteGoal(id) {
if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç›®æ¨™å—ï¼Ÿ')) {
goals = goals.filter(g => g.id !== id);
saveGoals();
loadGoals();
updateStats();
updateFreedomPrediction();
alert('ç›®æ¨™å·²åˆªé™¤ï¼');
}
}

// é—œé–‰ç·¨è¼¯æ¨¡æ…‹æ¡†
function closeEditModal() {
document.getElementById('editGoalModal').style.display = 'none';
currentEditingGoalId = null;
}

// è¼‰å…¥ç›®æ¨™
function loadGoals() {
const container = document.getElementById('goalsList');
container.innerHTML = '';

if (goals.length === 0) {
container.innerHTML = '<p style="color: #666; text-align: center;">å°šæœªè¨­å®šç›®æ¨™</p>';
return;
}

goals.forEach(goal => {
const goalElement = document.createElement('div');
goalElement.className = 'goal-item';

// è¨ˆç®—é€²åº¦
const totalValue = calculateTotalValue();
const progress = Math.min((totalValue / goal.amount) * 100, 100);

goalElement.innerHTML = `
<div class="goal-actions">
<button class="btn-edit" onclick="editGoal(${goal.id})">ç·¨è¼¯</button>
<button class="btn-danger" style="padding: 5px 10px; border: none; border-radius: 5px; color: white; cursor: pointer;"
onclick="deleteGoal(${goal.id})">åˆªé™¤</button>
</div>
<div class="goal-header">
<strong>${goal.name}</strong>
<span>$${goal.amount.toLocaleString()}</span>
</div>
<div>ç›®æ¨™ï¼š${goal.years}å¹´å…§é”æˆ</div>
<div class="progress-bar">
<div class="progress-fill" style="width: ${progress}%"></div>
</div>
<div style="font-size: 12px; color: #666;">
é€²åº¦ï¼š${progress.toFixed(1)}% | é‚„å·®ï¼š$${(goal.amount - totalValue).toLocaleString()}
</div>
`;
container.appendChild(goalElement);
});
}

// æ·»åŠ ç¾é‡‘æµ
function addCashflow() {
const type = document.getElementById('cashflowType').value;
const amount = parseFloat(document.getElementById('cashflowAmount').value);
const date = document.getElementById('cashflowDate').value;

if (!amount || !date) {
alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
return;
}

const cashflow = {
id: Date.now(),
type,
amount,
date,
note: type === 'deposit' ? 'å­˜å…¥è³‡é‡‘' : 'æå–è³‡é‡‘'
};

cashflows.push(cashflow);
saveCashflows();
loadCashflows();
updateStats();
updateChart();
updateFreedomPrediction();

document.getElementById('cashflowAmount').value = '';
alert('ç¾é‡‘æµå·²è¨˜éŒ„ï¼');
}

// åˆªé™¤ç¾é‡‘æµè¨˜éŒ„
function deleteCashflow(id) {
if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç¾é‡‘æµè¨˜éŒ„å—ï¼Ÿ')) {
cashflows = cashflows.filter(c => c.id !== id);
saveCashflows();
loadCashflows();
updateStats();
updateChart();
updateFreedomPrediction();
}
}

// è¼‰å…¥ç¾é‡‘æµè¨˜éŒ„
function loadCashflows() {
const container = document.getElementById('cashflowList');
container.innerHTML = '';

// æ’åºï¼šæœ€æ–°çš„åœ¨å‰é¢
const sortedCashflows = [...cashflows].sort((a, b) => new Date(b.date) - new Date(a.date));

sortedCashflows.forEach(cashflow => {
const cashflowElement = document.createElement('div');
cashflowElement.className = 'cashflow-item';

const cashflowType = cashflow.type === 'deposit' ? 'å­˜å…¥' : 'æå–';
const cashflowColor = cashflow.type === 'deposit' ? '#10b981' : '#ef4444';

cashflowElement.innerHTML = `
<div>
<span style="font-weight: 500;">${cashflow.date}</span>
<span style="color: ${cashflowColor}; margin-left: 10px;">${cashflowType}</span>
</div>
<div style="display: flex; align-items: center; gap: 10px;">
<span style="font-weight: bold; color: ${cashflowColor};">$${cashflow.amount.toLocaleString()}</span>
<button style="padding: 3px 8px; background: #ef4444; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;"
onclick="deleteCashflow(${cashflow.id})">åˆªé™¤</button>
</div>
`;
container.appendChild(cashflowElement);
});

// æ›´æ–°ç¾é‡‘æµç¸½è¨ˆ
updateCashflowSummary();
}

// æ›´æ–°ç¾é‡‘æµæ‘˜è¦
function updateCashflowSummary() {
const deposits = cashflows.filter(c => c.type === 'deposit').reduce((sum, c) => sum + c.amount, 0);
const withdraws = cashflows.filter(c => c.type === 'withdraw').reduce((sum, c) => sum + c.amount, 0);
const netCashflow = deposits - withdraws;

document.getElementById('totalDeposit').textContent = `$${deposits.toLocaleString()}`;
document.getElementById('totalWithdraw').textContent = `$${withdraws.toLocaleString()}`;
document.getElementById('netCashflow').textContent = `$${netCashflow.toLocaleString()}`;
}

// è¨ˆç®—ç¸½è³‡ç”¢åƒ¹å€¼
function calculateTotalValue() {
let total = 0;

// è¨ˆç®—æŠ•è³‡åƒ¹å€¼ï¼ˆåªè¨ˆç®—è²·å…¥ä¸”æœªè³£å‡ºçš„éƒ¨åˆ†ï¼‰
records.forEach(record => {
if (record.action === 'buy' && !record.matched) {
// å¦‚æœæ˜¯æ¸¯è‚¡ï¼Œè½‰æ›ç‚ºç¾å…ƒ
if (record.currency === 'HKD') {
total += record.total / settings.usdHkdRate;
} else {
total += record.total;
}
}
});

// è¨ˆç®—ç¾é‡‘æµå½±éŸ¿
const netCashflow = cashflows.reduce((sum, cf) => {
return cf.type === 'deposit' ? sum + cf.amount : sum - cf.amount;
}, 0);

// åŠ ä¸Šç¾é‡‘æµæ·¨å€¼
total += netCashflow;

return total;
}

// è¨ˆç®—ç¸½ç›ˆè™§ï¼ˆåªè¨ˆç®—è³£å‡ºçš„ç›ˆè™§ï¼‰
function calculateTotalProfit() {
return records.reduce((sum, record) => sum + (record.profitLoss || 0), 0);
}

// æ›´æ–°çµ±è¨ˆæ•¸æ“š
function updateStats() {
const totalValue = calculateTotalValue();
const totalProfit = calculateTotalProfit();

// è¨ˆç®—å›å ±ç‡
const totalDeposit = cashflows.filter(c => c.type === 'deposit').reduce((sum, c) => sum + c.amount, 0);
const roi = totalDeposit > 0 ? ((totalProfit / totalDeposit) * 100).toFixed(1) : 0;

// è¨ˆç®—ç›®æ¨™é€²åº¦
const mainGoal = goals.length > 0 ? goals[0] : null;
const goalProgress = mainGoal ? Math.min((totalValue / mainGoal.amount) * 100, 100).toFixed(1) : 0;

// æ ¹æ“šè¨­å®šè½‰æ›è²¨å¹£
let displayValue = totalValue;
let displayProfit = totalProfit;

if (settings.currency !== 'USD') {
if (settings.currency === 'HKD') {
displayValue = totalValue * settings.usdHkdRate;
displayProfit = totalProfit * settings.usdHkdRate;
} else if (settings.currency === 'TWD') {
displayValue = totalValue * settings.usdTwdRate;
displayProfit = totalProfit * settings.usdTwdRate;
}
}

const currencySymbol = settings.currency === 'USD' ? '$' :
settings.currency === 'HKD' ? 'HK$' : 'NT$';

document.getElementById('totalValue').textContent = `${currencySymbol}${displayValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
document.getElementById('totalProfit').textContent = `${currencySymbol}${displayProfit.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
document.getElementById('goalProgress').textContent = `${goalProgress}%`;
document.getElementById('roi').textContent = `${roi}%`;
}

// æ›´æ–°è²¡å‹™è‡ªç”±é æ¸¬
function updateFreedomPrediction() {
const container = document.getElementById('freedomPrediction');

if (goals.length === 0) {
container.innerHTML = '<p style="color: #666; text-align: center;">è«‹å…ˆè¨­å®šè²¡å‹™ç›®æ¨™</p>';
return;
}

const goal = goals[0]; // å–ç¬¬ä¸€å€‹ç›®æ¨™
const currentValue = calculateTotalValue();
const yearsRemaining = goal.years;

// è¨ˆç®—æ‰€éœ€å¹´åŒ–å›å ±ç‡
const requiredReturn = Math.pow(goal.amount / currentValue, 1 / yearsRemaining) - 1;
const requiredReturnPercent = (requiredReturn * 100).toFixed(2);

// é æ¸¬çµæœ
let predictionHTML = `
<p><strong>ç›®æ¨™ï¼š</strong>${goal.name} ($${goal.amount.toLocaleString()})</p>
<p><strong>ç›®å‰åƒ¹å€¼ï¼š</strong>$${currentValue.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</p>
<p><strong>ç›®æ¨™æœŸé™ï¼š</strong>${yearsRemaining}å¹´</p>
`;

if (currentValue >= goal.amount) {
predictionHTML += `<p style="color: #10b981; font-weight: bold;">ğŸ‰ æ­å–œï¼æ‚¨å·²é”æˆè²¡å‹™ç›®æ¨™ï¼</p>`;
} else if (requiredReturn <= 0.15) { // 15%ä»¥ä¸‹çš„å›å ±ç‡è¢«èªç‚ºæ˜¯å¯é”æˆçš„
predictionHTML += `
<p><strong>æ‰€éœ€å¹´åŒ–å›å ±ç‡ï¼š</strong><span style="color: #10b981;">${requiredReturnPercent}%</span></p>
<p style="color: #10b981;">âœ… é€™å€‹å›å ±ç‡æ˜¯å¯é”æˆçš„ç›®æ¨™</p>
`;
} else {
predictionHTML += `
<p><strong>æ‰€éœ€å¹´åŒ–å›å ±ç‡ï¼š</strong><span style="color: #ef4444;">${requiredReturnPercent}%</span></p>
<p style="color: #ef4444;">âš ï¸ é€™å€‹å›å ±ç‡è¼ƒé«˜ï¼Œå»ºè­°è€ƒæ…®ï¼š</p>
<ul style="margin-left: 20px; margin-top: 5px;">
<li>å»¶é•·ç›®æ¨™æœŸé™</li>
<li>å¢åŠ æ¯æœˆæŠ•è³‡é‡‘é¡</li>
<li>èª¿æ•´æŠ•è³‡çµ„åˆé…ç½®</li>
</ul>
`;
}

container.innerHTML = predictionHTML;
}

// ç”Ÿæˆæ–°é‡‘å¥
function generateNewQuote() {
const quotes = [
"æŠ•è³‡å°±åƒæ»¾é›ªçƒï¼Œä½ éœ€è¦æ‰¾åˆ°æ¿•æ½¤çš„é›ªå’Œé•·é•·çš„å¡é“ã€‚ - è¯å€«Â·å·´è²ç‰¹",
"åœ¨åˆ¥äººè²ªå©ªæ™‚ææ‡¼ï¼Œåœ¨åˆ¥äººææ‡¼æ™‚è²ªå©ªã€‚ - è¯å€«Â·å·´è²ç‰¹",
"æ™‚é–“æ˜¯ä½ çš„æœ‹å‹ï¼Œè¡å‹•æ˜¯ä½ çš„æ•µäººã€‚ - ç´„ç¿°Â·æŸæ ¼",
"ä¸è¦æŠŠæ‰€æœ‰é›è›‹æ”¾åœ¨åŒä¸€å€‹ç±ƒå­è£¡ã€‚",
"å¸‚å ´çŸ­æœŸæ˜¯æŠ•ç¥¨æ©Ÿï¼Œé•·æœŸæ˜¯é«”é‡è¨ˆã€‚ - ç­å‚‘æ˜Â·è‘›æ‹‰æ¼¢",
"è²¡å‹™è‡ªç”±ä¸æ˜¯æ“æœ‰å¤šå°‘éŒ¢ï¼Œè€Œæ˜¯æ“æœ‰é¸æ“‡çš„æ¬Šåˆ©ã€‚",
"æœ€å¥½çš„æŠ•è³‡å°±æ˜¯æŠ•è³‡è‡ªå·±ã€‚ - è¯å€«Â·å·´è²ç‰¹",
"é¢¨éšªä¾†è‡ªæ–¼ä½ ä¸çŸ¥é“è‡ªå·±åœ¨åšä»€éº¼ã€‚ - è¯å€«Â·å·´è²ç‰¹",
"æ¯”ç‰¹å¹£ä¸æ˜¯è²¨å¹£ï¼Œæ˜¯æ•¸ä½é»ƒé‡‘ã€‚ - éº¥å¯Â·è³½å‹’",
"æ¸¯è‚¡æ³¢å‹•å¤§ï¼Œä½†é•·ç·šçœ‹å¥½ä¸­åœ‹ç¶“æ¿Ÿå¢é•·ã€‚",
"ç¾è‚¡é•·ç·šä¾ç„¶æ˜¯æœ€ç©©å¥çš„æŠ•è³‡å¸‚å ´ã€‚",
"è²¡å‹™è‡ªç”±çš„è·¯ä¸Šï¼Œè€å¿ƒæ¯”æ™ºå•†æ›´é‡è¦ã€‚ - æŸ¥ç†Â·è’™æ ¼",
"ä»Šå¤©çš„ä¸€è¬å…ƒæŠ•è³‡ï¼Œå¯èƒ½æ˜¯æ˜å¤©çš„åè¬å…ƒã€‚",
"é”åˆ°ç¬¬ä¸€å€‹ä¸€ç™¾è¬æœ€é›£ï¼Œä¹‹å¾Œæœƒè¶Šä¾†è¶Šå®¹æ˜“ã€‚"
];

const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
const totalValue = calculateTotalValue();
const totalProfit = calculateTotalProfit();

document.getElementById('quoteText').innerHTML = `
"${randomQuote.split(' - ')[0]}"
${randomQuote.includes(' - ') ? '<br><small>' + randomQuote.split(' - ')[1] + '</small>' : ''}
<br><br>
<small>ğŸ’° ç¸½è³‡ç”¢ï¼š$${totalValue.toLocaleString()} | ğŸ“ˆ å·²å¯¦ç¾ç›ˆè™§ï¼š${totalProfit >= 0 ? '+' : ''}$${totalProfit.toLocaleString()}</small>
`;
}

// åˆå§‹åŒ–åœ–è¡¨
function initializeChart() {
const ctx = document.getElementById('portfolioChart').getContext('2d');

portfolioChart = new Chart(ctx, {
type: 'doughnut',
data: {
labels: ['ç¾è‚¡', 'æ¸¯è‚¡', 'æ¯”ç‰¹å¹£', 'ç¾é‡‘'],
datasets: [{
data: [0, 0, 0, 0],
backgroundColor: [
'#3b82f6',
'#10b981',
'#f59e0b',
'#94a3b8'
]
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
position: 'bottom'
}
}
}
});

updateChart();
}

// æ›´æ–°åœ–è¡¨
function updateChart() {
if (!portfolioChart) return;

const usValue = records.filter(r => r.type === 'us' && r.action === 'buy' && !r.matched).reduce((sum, r) => sum + r.total, 0);
const hkValue = records.filter(r => r.type === 'hk' && r.action === 'buy' && !r.matched).reduce((sum, r) => sum + r.total, 0) / settings.usdHkdRate;
const btcValue = records.filter(r => r.type === 'btc' && r.action === 'buy' && !r.matched).reduce((sum, r) => sum + r.total, 0);

const deposits = cashflows.filter(c => c.type === 'deposit').reduce((sum, c) => sum + c.amount, 0);
const withdraws = cashflows.filter(c => c.type === 'withdraw').reduce((sum, c) => sum + c.amount, 0);
const totalInvested = usValue + hkValue + btcValue;
const cashValue = deposits - withdraws - totalInvested;

const totalValue = usValue + hkValue + btcValue + Math.max(cashValue, 0);

// è¨ˆç®—ç™¾åˆ†æ¯”
const usPercent = totalValue > 0 ? (usValue / totalValue * 100).toFixed(1) : 0;
const hkPercent = totalValue > 0 ? (hkValue / totalValue * 100).toFixed(1) : 0;
const btcPercent = totalValue > 0 ? (btcValue / totalValue * 100).toFixed(1) : 0;
const cashPercent = totalValue > 0 ? (Math.max(cashValue, 0) / totalValue * 100).toFixed(1) : 0;

portfolioChart.data.datasets[0].data = [
Math.max(usValue, 0),
Math.max(hkValue, 0),
Math.max(btcValue, 0),
Math.max(cashValue, 0)
];

portfolioChart.update();

// æ›´æ–°ç™¾åˆ†æ¯”é¡¯ç¤º
document.getElementById('usPercent').textContent = `${usPercent}%`;
document.getElementById('hkPercent').textContent = `${hkPercent}%`;
document.getElementById('btcPercent').textContent = `${btcPercent}%`;
document.getElementById('cashPercent').textContent = `${cashPercent}%`;
}

// åˆ†äº«åŠŸèƒ½
function shareToThreads() {
const quote = document.getElementById('quoteText').textContent;
alert(`åˆ†äº«åˆ°Threadsï¼š\n\n${quote}\n\nï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æœƒç›´æ¥åˆ†äº«ï¼‰`);
}

function shareToIG() {
const quote = document.getElementById('quoteText').textContent;
alert(`åˆ†äº«åˆ°Instagramï¼š\n\n${quote}\n\nï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æœƒç›´æ¥åˆ†äº«ï¼‰`);
}

// å„²å­˜æ•¸æ“š
function saveRecords() {
localStorage.setItem('investmentRecords', JSON.stringify(records));
}

function saveGoals() {
localStorage.setItem('investmentGoals', JSON.stringify(goals));
}

function saveCashflows() {
localStorage.setItem('cashflows', JSON.stringify(cashflows));
}

// è¼‰å…¥æ•¸æ“š
function loadRecords() {
displayAllRecords();
}

// æ¸…é™¤æ‰€æœ‰æ•¸æ“š
function clearAllData() {
if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
localStorage.clear();
records = [];
goals = [];
cashflows = [];

loadRecords();
loadGoals();
loadCashflows();
updateStats();
updateChart();
updateFreedomPrediction();

alert('æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤ï¼');
}
}

// è²¨å¹£æ›´æ–°
function updateCurrency() {
// ç•¶è²¨å¹£è¨­å®šæ”¹è®Šæ™‚ï¼Œæ›´æ–°é¡¯ç¤º
updateStats();
displayAllRecords();
}
</script>
</body>
</html>
